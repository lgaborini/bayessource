<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • bayessource</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">bayessource</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Introduction</h1>
                        <h4 class="author">Lorenzo Gaborini</h4>
            
            <h4 class="date">2017-08-02</h4>
          </div>

    
    
<div class="contents">
<p>This vignette explains briefly how to use this package.</p>
<div id="package-goal" class="section level2">
<h2 class="hasAnchor">
<a href="#package-goal" class="anchor"></a>Package goal</h2>
<p>The package has been conceived to evaluate whether two sets of items (a reference set and a questioned set) belong to the same population or not. Each item is described with a vector of measurements.</p>
<p>The evaluation is performed using Bayesian statistics, particularly Gibbs sampling. Particular care has been given in order to obtain performing functions: the main core has been written using <code>Rcpp</code>.</p>
<p>For theoretical details, see <span class="citation">(Bozza et al. 2008)</span>.</p>
</div>
<div id="package-contents" class="section level2">
<h2 class="hasAnchor">
<a href="#package-contents" class="anchor"></a>Package contents</h2>
</div>
<div id="usage" class="section level1">
<h1 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h1>
<p>This section describes the usage on some made-up data.</p>
<div id="sample-data" class="section level2">
<h2 class="hasAnchor">
<a href="#sample-data" class="anchor"></a>Sample data</h2>
<p>We create some dummy data, taken from two bivariate Gaussian distributions with known means and covariances. Covariance matrices are generated using the bundled <code>rwish</code> function, to obtain invertible matrices with ease.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)

p &lt;-<span class="st"> </span><span class="dv">2</span>
mean.quest &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)
mean.ref &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>)
cov.quest &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rwish.html">rwish</a></span>(<span class="dv">3</span>, <span class="kw">diag</span>(<span class="dv">2</span>))
cov.ref &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rwish.html">rwish</a></span>(<span class="dv">5</span>, <span class="kw">diag</span>(<span class="dv">2</span>))
n.quest &lt;-<span class="st"> </span><span class="dv">20</span>
n.ref &lt;-<span class="st"> </span>n.quest

df.quest &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw"><a href="../reference/rmvnorm.html">rmvnorm</a></span>(n.quest, mean.quest, cov.quest))
df.ref &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw"><a href="../reference/rmvnorm.html">rmvnorm</a></span>(n.ref, mean.ref, cov.ref))</code></pre></div>
<p>Here are the datasets:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X1, <span class="dt">y =</span> X2), <span class="dt">col =</span> <span class="st">'red'</span>, <span class="dt">data =</span> df.quest) <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X1, <span class="dt">y =</span> X2), <span class="dt">col =</span> <span class="st">'blue'</span>, <span class="dt">data =</span> df.ref)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>It is clear that the two samples come from different populations, hence we expect a low likelihood-ratio value.</p>
</div>
<div id="model-and-prior-specification" class="section level2">
<h2 class="hasAnchor">
<a href="#model-and-prior-specification" class="anchor"></a>Model and prior specification</h2>
<p>The package implements a two-sample Bayesian Hierarchical model with Gaussian multivariate likelihoods, and Inverse-Wishart prior on the covariance matrices.<br>
The theoretical details are specified in <span class="citation">(Bozza et al. 2008)</span>.</p>
<p>Let us recall the model definition. We note with <span class="math inline">\(X_{ij}\)</span> the <span class="math inline">\(j\)</span>-th sample from the <span class="math inline">\(i\)</span>-th population, <span class="math inline">\(i = 1,2\)</span>. The two populations are Gaussians, with means <span class="math inline">\(\theta_i\)</span>, and covariances <span class="math inline">\(W_i\)</span>. <span class="math display">\[
X_{ij} \; | \; \theta_i, \; W_i \sim \quad N(\theta_i, W_i) \quad \forall j = 1, \ldots, n \]</span> <span class="math display">\[\theta_i \; | \; \mu, B \sim \quad N(\mu, B)\]</span> <span class="math display">\[W_i \; | \; U, n_w \sim \quad IW(U, n_w)\]</span></p>
<p>where <span class="math inline">\(n_w &gt; 2p\)</span>, and <span class="math inline">\(U\)</span> is s.t. <span class="math display">\[ E[W_i] = \frac{U}{n_w - 2(p + 1)} \]</span> (parametrization according to <span class="citation">(Press 2012)</span>).</p>
<p>As the model is Bayesian, we are required to specify the hyperparameters <span class="math inline">\(\mu, B, U, n_w\)</span>, as well as the Gibbs chain initialization <span class="math inline">\(W_i\)</span>.<br>
Notice that inference is propagated by supplying the inverses of covariance matrices, i.e. <span class="math inline">\(B^{-1}\)</span> and <span class="math inline">\(W_i^{-1}\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eps &lt;-<span class="st"> </span><span class="fl">0.001</span>
B.inv &lt;-<span class="st"> </span>eps<span class="op">*</span><span class="kw">diag</span>(p)
W.inv.<span class="dv">1</span> &lt;-<span class="st"> </span>eps<span class="op">*</span><span class="kw">diag</span>(p)
W.inv.<span class="dv">2</span> &lt;-<span class="st"> </span>eps<span class="op">*</span><span class="kw">diag</span>(p)
U &lt;-<span class="st"> </span>eps<span class="op">*</span><span class="kw">diag</span>(p)
nw &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>(p <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
mu &lt;-<span class="st"> </span>(mean.quest <span class="op">+</span><span class="st"> </span>mean.ref)<span class="op">/</span><span class="dv">2</span></code></pre></div>
</div>
<div id="log-lr-computation" class="section level2">
<h2 class="hasAnchor">
<a href="#log-lr-computation" class="anchor"></a>Log-LR computation</h2>
<p>Once the parameters are specified, we can compute the marginal likelihood (not particularly useful):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">burn.in =<span class="st"> </span><span class="dv">1000</span>
n.iter =<span class="st"> </span><span class="dv">10000</span>
<span class="kw"><a href="../reference/marginalLikelihood.html">marginalLikelihood</a></span>(<span class="kw">as.matrix</span>(df.quest), n.iter, B.inv, W.inv.<span class="dv">1</span>, U, nw, mu, burn.in, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
## [1] -103.1976</code></pre></div>
<p>and the log-LR value:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/samesource_C.html">samesource_C</a></span>(<span class="kw">as.matrix</span>(df.quest), <span class="kw">as.matrix</span>(df.ref), n.iter, B.inv, W.inv.<span class="dv">1</span>, W.inv.<span class="dv">2</span>, U, nw, mu, burn.in, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
## [1] 5.318163</code></pre></div>
<p>Notice how low it is compared to a subset of original data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/samesource_C.html">samesource_C</a></span>(<span class="kw">as.matrix</span>(df.ref)[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>,], <span class="kw">as.matrix</span>(df.ref), n.iter, B.inv, W.inv.<span class="dv">1</span>, W.inv.<span class="dv">2</span>, U, nw, mu, burn.in, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
## [1] 44.94793</code></pre></div>
</div>
</div>
<div id="diagnostics" class="section level1">
<h1 class="hasAnchor">
<a href="#diagnostics" class="anchor"></a>Diagnostics</h1>
<p>The package supports the output of the entire chain for <span class="math inline">\(\theta_i\)</span> and <span class="math inline">\(W^{-1}_i\)</span> (i.e., the inverses of <span class="math inline">\(W_i\)</span>).<br>
At the time, this is possible only during the computation of a single marginal likelihood, in this case the one related to the sample from the questioned population.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/marginalLikelihood.html">marginalLikelihood</a></span>(<span class="kw">as.matrix</span>(df.quest), n.iter, B.inv, W.inv.<span class="dv">1</span>, U, nw, mu, burn.in, <span class="dt">output.mcmc =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Notice that <code>results</code> now is a <code>list</code>, where <code>results$value</code> holds the marginal likelihood value, and <code>results$mcmc</code> is the <code>coda</code> object which holds the chain output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(results<span class="op">$</span>mcmc, <span class="dv">4</span>)
## Markov Chain Monte Carlo (MCMC) output:
## Start = 1001 
## End = 1005 
## Thinning interval = 1 
##          theta.1    theta.2  W.inv.1   W.inv.2   W.inv.3   W.inv.4
## [1,] -0.05124708 -0.5158918 2.080576 0.8013721 0.8013721 0.6182008
## [2,]  0.15890906 -1.3313169 4.199290 1.5187373 1.5187373 0.7825987
## [3,]  0.07012506 -1.0277897 4.421625 1.3296159 1.3296159 0.7385559
## [4,]  0.13466603 -1.1318374 2.637289 0.8712054 0.8712054 0.6912608
## [5,]  0.33203618 -1.1898417 1.833229 0.6652245 0.6652245 0.5865550</code></pre></div>
<p>Remember that R is column-major: <code>W.inv.1</code> is <span class="math inline">\(W^{-1}_1(1,1)\)</span>, <code>W.inv.2</code> is <span class="math inline">\(W^{-1}_1(2,1)\)</span> and so on.<br>
Using standard <code>coda</code> tools, we can perform diagnostics, such as summaries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(coda)
<span class="kw">summary</span>(results<span class="op">$</span>mcmc)</code></pre></div>
<pre><code>## 
## Iterations = 1001:10000
## Thinning interval = 1 
## Number of chains = 1 
## Sample size per chain = 9000 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##            Mean     SD Naive SE Time-series SE
## theta.1  0.1790 0.1877 0.001978       0.001925
## theta.2 -1.0844 0.4032 0.004250       0.004166
## W.inv.1  3.2366 0.8990 0.009476       0.009776
## W.inv.2  1.0592 0.3619 0.003815       0.003897
## W.inv.3  1.0592 0.3619 0.003815       0.003897
## W.inv.4  0.7002 0.1942 0.002047       0.002088
## 
## 2. Quantiles for each variable:
## 
##            2.5%      25%     50%     75%   97.5%
## theta.1 -0.1927  0.05481  0.1799  0.3026  0.5479
## theta.2 -1.8773 -1.34763 -1.0813 -0.8189 -0.2814
## W.inv.1  1.7615  2.59596  3.1426  3.7951  5.2473
## W.inv.2  0.4540  0.79795  1.0292  1.2811  1.8676
## W.inv.3  0.4540  0.79795  1.0292  1.2811  1.8676
## W.inv.4  0.3676  0.56185  0.6845  0.8177  1.1201</code></pre>
<p>and traceplots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">traceplot</span>(results<span class="op">$</span>mcmc)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="672"><img src="introduction_files/figure-html/unnamed-chunk-11-2.png" width="672"><img src="introduction_files/figure-html/unnamed-chunk-11-3.png" width="672"><img src="introduction_files/figure-html/unnamed-chunk-11-4.png" width="672"><img src="introduction_files/figure-html/unnamed-chunk-11-5.png" width="672"><img src="introduction_files/figure-html/unnamed-chunk-11-6.png" width="672"></p>
<p>We can recover the original matrices by reshaping the desired columns (e.g. for <code>W.inv</code>) into a matrix/3D array:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n.samples &lt;-<span class="st"> </span><span class="kw">nrow</span>(results<span class="op">$</span>mcmc)
W.inv.samples &lt;-<span class="st"> </span>results<span class="op">$</span>mcmc[, <span class="kw">paste0</span>(<span class="st">'W.inv.'</span>, <span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span>(p<span class="op">^</span><span class="dv">2</span>)))]
<span class="kw">head</span>(W.inv.samples, <span class="dv">5</span>)
## Markov Chain Monte Carlo (MCMC) output:
## Start = 1001 
## End = 1006 
## Thinning interval = 1 
##       W.inv.1   W.inv.2   W.inv.3   W.inv.4
## [1,] 2.080576 0.8013721 0.8013721 0.6182008
## [2,] 4.199290 1.5187373 1.5187373 0.7825987
## [3,] 4.421625 1.3296159 1.3296159 0.7385559
## [4,] 2.637289 0.8712054 0.8712054 0.6912608
## [5,] 1.833229 0.6652245 0.6652245 0.5865550
## [6,] 3.387628 0.8772191 0.8772191 0.5088544
W.inv.samples.cube &lt;-<span class="st"> </span><span class="kw">array</span>(W.inv.samples, <span class="dt">dim =</span> <span class="kw">c</span>(n.samples, p, p))
<span class="kw">dim</span>(W.inv.samples.cube)
## [1] 9000    2    2</code></pre></div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Bozza2008Probabilistic">
<p>Bozza, Silvia, Franco Taroni, Raymond Marquis, and Matthieu Schmittbuhl. 2008. “Probabilistic Evaluation of Handwriting Evidence: Likelihood Ratio for Authorship.” <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em> 57 (3): 329–41. doi:<a href="https://doi.org/10.1111/j.1467-9876.2007.00616.x">10.1111/j.1467-9876.2007.00616.x</a>.</p>
</div>
<div id="ref-Press2012Applied">
<p>Press, S James. 2012. <em>Applied Multivariate Analysis: Using Bayesian and Frequentist Methods of Inference</em>. Courier Corporation.</p>
</div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#package-goal">Package goal</a></li>
      <li><a href="#package-contents">Package contents</a></li>
      <li>
<a href="#usage">Usage</a><ul class="nav nav-pills nav-stacked">
<li><a href="#sample-data">Sample data</a></li>
      <li><a href="#model-and-prior-specification">Model and prior specification</a></li>
      <li><a href="#log-lr-computation">Log-LR computation</a></li>
      </ul>
</li>
      <li>
<a href="#diagnostics">Diagnostics</a><ul class="nav nav-pills nav-stacked">
<li><a href="#references">References</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Lorenzo Gaborini.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
